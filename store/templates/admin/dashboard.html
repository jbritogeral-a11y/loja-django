{% extends "admin/base_site.html" %}
<!-- Dashboard Final Location -->
{% load i18n static %}

{% block extrastyle %}
{{ block.super }}
<style>
    /* Estilos do Dashboard */
    .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    .dashboard-card {
        background: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        border-left: 4px solid #417690;
        transition: transform 0.2s;
    }
    .dashboard-card:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    .dashboard-card h3 { margin: 0 0 10px 0; color: #666; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; }
    .dashboard-card .value { font-size: 28px; font-weight: 700; color: #333; }
    
    .dashboard-section { margin-bottom: 40px; background: #fff; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); overflow: hidden; }
    .dashboard-section h2 { 
        background: #f8f9fa; padding: 15px 20px; margin: 0; font-size: 16px; 
        color: #333; border-bottom: 1px solid #eee; font-weight: 600;
    }
    
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 12px 20px; text-align: left; border-bottom: 1px solid #eee; font-size: 14px; }
    th { background: #fcfcfc; font-weight: 600; color: #555; font-size: 13px; text-transform: uppercase; }
    tr:last-child td { border-bottom: none; }
    
    .status-badge { padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: 600; text-transform: uppercase; }
    .status-paid { background: #d1fae5; color: #065f46; }
    .status-pending { background: #fef3c7; color: #92400e; }
    .status-shipped { background: #dbeafe; color: #1e40af; }
    .status-canceled { background: #fee2e2; color: #991b1b; }
</style>
{% endblock %}

{% block content %}
<div id="content-main">
    
    <!-- M√©tricas Principais -->
    <div class="dashboard-grid">
        <div class="dashboard-card">
            <h3>Vendas Hoje</h3>
            <div class="value">{{ sales_day|floatform:2 }} ‚Ç¨</div>
        </div>
        <div class="dashboard-card">
            <h3>Vendas Semana</h3>
            <div class="value">{{ sales_week|floatform:2 }} ‚Ç¨</div>
        </div>
        <div class="dashboard-card">
            <h3>Vendas M√™s</h3>
            <div class="value">{{ sales_month|floatform:2 }} ‚Ç¨</div>
        </div>
        <div class="dashboard-card" style="border-left-color: #10b981;">
            <h3>Total Clientes</h3>
            <div class="value">{{ total_clients }}</div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
        <!-- Top Artigos -->
        <div class="dashboard-section">
            <h2>üèÜ Top 10 Artigos Mais Vendidos</h2>
            <table>
                <thead><tr><th>Produto</th><th style="text-align: right;">Qtd. Vendida</th></tr></thead>
                <tbody>
                    {% for item in top_products %}
                    <tr><td>{{ item.product__name }}</td><td style="text-align: right;"><strong>{{ item.total_sold }}</strong></td></tr>
                    {% empty %}<tr><td colspan="2" style="text-align: center; color: #999;">Sem dados</td></tr>{% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Cerim√≥nias -->
        <div class="dashboard-section">
            <h2>üéâ Clientes por Cerim√≥nia</h2>
            <table>
                <thead><tr><th>Cerim√≥nia</th><th style="text-align: right;">Inscritos</th></tr></thead>
                <tbody>
                    {% for c in ceremonies %}
                    <tr><td>{{ c.name }}</td><td style="text-align: right;"><strong>{{ c.total_registrations }}</strong></td></tr>
                    {% empty %}<tr><td colspan="2" style="text-align: center; color: #999;">Sem cerim√≥nias</td></tr>{% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Encomendas Recentes -->
    <div class="dashboard-section">
        <h2>üì¶ √öltimas Encomendas</h2>
        <table>
            <thead><tr><th>Encomenda</th><th>Cliente</th><th>Data</th><th>Total</th><th>Estado</th></tr></thead>
            <tbody>
                {% for order in recent_orders %}
                <tr>
                    <td><a href="{% url 'admin:store_order_change' order.id %}" style="font-weight: bold;">#{{ order.id }}</a></td>
                    <td>{{ order.full_name }}</td>
                    <td>{{ order.created_at|date:"d/m/Y H:i" }}</td>
                    <td>{{ order.total_price }} ‚Ç¨</td>
                    <td><span class="status-badge status-{{ order.status }}">{{ order.get_status_display }}</span></td>
                </tr>
                {% empty %}<tr><td colspan="5" style="text-align: center; color: #999;">Sem encomendas recentes</td></tr>{% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Apps do Django (Menu de Gest√£o) -->
    <div class="dashboard-section"><h2>‚öôÔ∏è Gest√£o da Loja</h2><div style="padding: 0;">{% include "admin/app_list.html" with app_list=app_list show_changelinks=True %}</div></div>
</div>
{% endblock %}